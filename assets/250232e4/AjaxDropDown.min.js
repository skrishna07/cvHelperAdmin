/*!
 * AjaxDropDown v1.2 | Pawel Bizley Brzozowski | https://github.com/bizley-code/Yii-AjaxDropDown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{accl:"active",addc:"",dely:300,dicl:"disabled",ercl:"",erst:"",hecl:"",hest:"",hicl:"hidden",keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",trig:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),t=" ajaxDropDownRecord",r="</a></li>",l="a.ajaxDropDownNext",s="a.ajaxDropDownPrev",o="button.ajaxDropDownSingleRemove",d="button.ajaxDropDownToggle",p='><a href="#" class="ajaxDropDownResult" data-id="',c="input[type=text]",f="</li>",v='<li class="dropdown-header',h="li.ajaxDropDownPage",D="li.ajaxDropDownPages",m='<li class="ajaxDropDownPages ajaxDropDownPage',u="li.ajaxDropDownSelected",g="span.ajaxDropDownPageNumber",w=' style="',x="ul.ajaxDropDownMenu",j=null,b=[],C=new Function("id","selection",n.onrm),y=new Function("id","label","selection",n.onsl),k=function(a){var e=[];for(var n in b)b[n].id!=a&&e.push(b[n]);b=e},P=this.find(x),R=this.find(c),N=this.find(d),T=this.find("div.ajaxDropDownButtons"),q='<li class="ajaxDropDownLoading';""!==n.locl&&(q+=" "+n.locl),q+='"',""!==n.lost&&(q+=w+n.lost+'"'),q+=">"+n.prba+f;var S=v;""!==n.hecl&&(S+=" "+n.hecl),S+='"',""!==n.hest&&(S+=w+n.hest+'"'),S+=">";var I=n.loca.mcha.replace(/{NUM}/g,n.minq),L=v;""!==n.ercl&&(L+=" "+n.ercl),L+='"',""!==n.erst&&(L+=w+n.erst+'"'),L+=">"+n.loca.erro+f;var M=v;""!==n.nrcl&&(M+=" "+n.nrcl),M+='"',""!==n.nrst&&(M+=w+n.nrst+'"'),M+=">"+n.loca.nrec+f;var U=function(){if(0===P.find(D).length){var e=N.data("page");e=1*e;var l=!1,s=S+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',o=s;o+=n.paen+n.loca.allr+'</li><li class="divider"></li>'+q;var d=R.val();d.length>0?d.length>=n.minq?(o=s,o+=n.paen+n.loca.rcon+" <strong>"+d,o+='</strong></li><li class="divider"></li>'+q,l=!0):o=S+I+f:l=!0,P.html(o),l&&a.post(n.url,{query:d,page:e}).fail(function(){P.append(L)}).done(function(e){var l=a.parseJSON(e);if(void 0===l.total&&(l.total=1),void 0===l.page&&(l.page=1),l.data.length){P.find("span.ajaxDropDownTotalPages").text(l.total);for(i in l.data){var s=m+l.page+t+l.data[i].id;""!==n.recl&&(s+=" "+n.recl),P.parent().parent().parent().find(u+l.data[i].id).length&&(s+=" "+n.accl),s+='"',""!==n.rest&&(s+=w+n.rest+'"'),s+=p+l.data[i].id+'">',l.data[i].mark&&(s+=n.mabe),s+=l.data[i].value,l.data[i].mark&&(s+=n.maen),s+=r,P.append(s)}if(l.total>1){var o='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(o+=" "+n.swcl),o+='"',""!==n.swst&&(o+=w+n.swst+'"'),o+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(o+=" "+n.prcl),1===l.page&&(o+=" "+n.dicl),o+='"',""!==n.prst&&(o+=w+n.prst+'"'),o+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(o+=" "+n.necl),l.page===l.total&&(o+=" "+n.dicl),o+='"',""!==n.nest&&(o+=w+n.nest+'"'),o+=">"+n.nebe+n.loca.next+n.neen+r,P.append(o)}}else P.append(M)}).always(function(){a("li.ajaxDropDownLoading").remove()})}};return this.on(n.trig,U),this.on("click",l,function(e){e.preventDefault(),e.stopPropagation(),P.find(s).removeClass(n.dicl),P.find(l).addClass(n.dicl);var i=N.data("page");if(i=1*i+1,P.find(h+i).length)P.find(D).addClass(n.hicl),P.find(h+i).removeClass(n.hicl),P.find(l).removeClass(n.dicl);else{var o=R.val();a.post(n.url,{query:o,page:i}).fail(function(){P.append(L)}).done(function(e){var s=a.parseJSON(e);if(s.data.length){P.find(D).addClass(n.hicl),void 0===s.total&&(s.total=1),void 0===s.page&&(s.page=1);for(var o in s.data){var d=m+s.page+t+s.data[o].id;""!==n.recl&&(d+=" "+n.recl),P.parent().parent().parent().find(u+s.data[o].id).length&&(d+=" "+n.accl),d+='"',""!==n.rest&&(d+=w+n.rest+'"'),d+=p+s.data[o].id+'">',s.data[o].mark&&(d+=n.mabe),d+=s.data[o].value,s.data[o].mark&&(d+=n.maen),d+=r,P.find(".divider.ajaxDropDownInfo").before(d)}s.page<s.total?P.find(l).removeClass(n.dicl):i=s.total}else P.append(M)})}N.data("page",i),P.find(g).text(i)}),this.on("click",s,function(a){a.preventDefault(),a.stopPropagation(),P.find(l).removeClass(n.dicl),P.find(s).addClass(n.dicl);var e=N.data("page");e=1*e-1,1>e&&(e=1),P.find(D).addClass(n.hicl),P.find(h+e).removeClass(n.hicl),e>1&&P.find(s).removeClass(n.dicl),N.data("page",e),P.find(g).text(e)}),this.on("keyup",c,function(){window.clearTimeout(j),a(this).parent().find(d).data("page",1),a(this).parent().find(x).find(D).remove(),n.keyt&&(j=window.setTimeout(function(){T.addClass("open"),U()},n.dely))}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var t=a(this).data("id"),r=a(this).html(),l=a(this).parent().parent().parent().parent().parent().find("ul.ajaxDropDownResults"),i="[]";if(n.smod&&(l.html(""),a(this).parent().parent().find(D).removeClass(n.accl),i=""),n.smod&&""===n.addc&&!n.smbt){var s=a(this).parent().parent().parent().find(o);N.hide(),s.show(),R.val(r.replace(/<.*?>/g,"").replace(/"/g,"'")),R.prop("disabled",!0),R.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+t+'" />'),b.push({id:t,label:r}),y(t,r,b)}else if(a(this).parent().hasClass(n.accl))a(this).parent().removeClass(n.accl),l.find(u+t).remove(),k(t),C(t,b);else{a(this).parent().addClass(n.accl);var d='<li class="ajaxDropDownSelected'+t;if(""!==n.rscl&&(d+=" "+n.rscl),d+='"',""!==n.rsst&&(d+=w+n.rsst+'"'),d+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(d+=" "+n.rmcl),d+='"',""!==n.rmst&&(d+=w+n.rmst+'"'),d+=' data-id="'+t+'">'+n.rmla+"</a>",""!==n.addc){var p=n.addc.replace(/{ID}/g,t);p=p.replace(/{VALUE}/g,r),d+=p}d+=r+'<input type="hidden" name="'+n.name+i+'" value="'+t+'" /></li>',l.append(d),b.push({id:t,label:r}),y(t,r,b)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault();var t=a(this).data("id");a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+t).removeClass(n.accl),a(this).parent().remove(),k(t),C(t,b)}),this.on("click",o,function(e){e.preventDefault();var n=a(this).parent().parent().find("input.singleResult"),t=n.val();n.remove(),R.prop("disabled",!1),R.val(""),a(this).hide(),N.show(),k(t),C(t,b)}),this}}(jQuery);